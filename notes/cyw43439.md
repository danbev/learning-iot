## CYW43439
Is a single-chip 802.11b, 802.11g, and 802.11.n radio with integrated Bluetooth
5.2 compatability from Cypress.
This chip is used for example on the Raspberry Pico Pi W (Wirless)
microcontroller board.

### Architecture
This component which on contains three major components as I understand it.

One is a ARM Cortex M3 32 bit RISC processor. This processor runs an operating
system named `HNDRTE` which is from Cypress.

The second is a WLAN component and the third is BT PHY/BT Clock Control.

If we use the Pico Pi W an example I think it would communicate with the
CYW43439 using SPI, SDIO or something to forward and receive frames. Also
control requests are passed from the host to CYW43439 and it responds with
device responses.

There is a host driver (DHD) that presents a driver interface. There is a bus
for this communication and there is a control channel and a data channel.
The message format is BDC protocol. TODO: what is this BDC protocol?

The transfers between the host and CYW43439 is message based (framed).
The SDIO bus is an addressable bus and each message must contain an explicit
device target address


### ioctl (input/output control)
Is a system call for device specific I/O operations. This takes a parameter
specifying the operation/command.

### SDPCM
This is a protocol, and in https://infineon.github.io/wifi-host-driver/html/index.html#overview
we find this:
```
The Bus layer provides bus level protocol handling. For SDIO, a bus protocol
known as SDPCM is used.

SDPCM - SDIO/SPI Bus Layer SDPCM Layer takes care of:
* Adding a Sequence number to packet sent to WLAN Chip
* Flow control between WHD and WLAN Chi
```
So this add credit management, is that what CM stand for perhaps?
SDIO Packet and Credit Management layer?
SDIO Packet Control Management layer?

### Country Locale Matrix (CLM)
This is a database maintained by Cypress and contains regulatory configuration
information like target power outputs of WiFi modules with respect to country,
bands, data rates, and channels.
This blob is loaded dynamically by the Cypress FMAC driver on module activation.

### generic SPI (gSPI)
This is a signaling mode, in addtion to the normal
[signaling modes](./sdio.md#signaling-modes). This provides fixed delays for
responses and data from the device, alignment of host gSPI frames (16 or 32
bits), little/big endian configuration, packet transfer through DMS for WLAN.

This mode can be enabled by setting strapping option SDIO_DATA_2, if this is
1 which is the default which will be SDIO. Pullling this low will enable gSPI.

```
    RP Pico Pi W                              CYW34439 (WiFi device)
  +-----------------+                      +----------------------+
  |     Host        |     SCLCK            |      Device          |
  |                 |--------------------->|                      |
  |                 |     DI               |                      |
  |                 |<-------------------->|                      |
  |                 |     DO               |                      |
  |                 |<-------------------->|                      |
  |                 |     IRQ              |                      |
  |                 |<-------------------->|                      |
  |                 |     CS               |                      |
  |                 |<-------------------->|                      |
  |                 |                      |                      |
  |                 |                      |                      |
  |                 |                      |                      |
  +-----------------+                      +----------------------+

DI = Data Input
DO = Data Output
CS = Chip select
```

The gSPI commands are structures of 32-bits:
```
31                                                         0
 +---------------------------------------------------------+
 |C|A|F1|F0| Address (17-bits)   | Packet content (11-bits)|
 +---------------------------------------------------------+

C = Command: 0=Read, 1= Write
A = Access: 0=Fixed, 1=Incremental address
F1/F0 = Function number:
          Func 0 (F0) 00=All SPI-specific registers
          Func 1 (F1) 01=Registers and memory beloging to other (non-spi?) block on the device
          Func 2 (F2) 10=DMA channel 1. WLAN packets up to 2048 bytes
          Func 3 (F3) 11=DMS channel 2 (options), like Func 2 up to 2048 bytes
```
In the documentation I was confused with the references to F0, F1, F2, and F3
but I think there are referring to commands with the above functions. Like a
command could be a read or write and then the function is specified after that.
So reading from one of the SPI registers would looks something like this I
think:
```
31                                                         0
 +-----------------------------------------------------------+
 |0|0|00|   0x0002               | 0                         |
 +-----------------------------------------------------------+
          0x0002 = Status Enable   Read field/bit 0
```

After a read/write transaction the gSPI interface supports a status notification
to the host which includes info about packet errors, protocol errors, etc. This
will be available in the Data Input wire/line is 32-bits with the following
format:
```
 Bit 0: Data Not Available
 Bit 1: Underflow
 Bit 2: Overflow
 Bit 3: F2 Interrupt
 Bit 4: Reserved?
 Bit 5: F2 RX ready        - F2 FIFO ready to receive data (the FIFO is empty)
 Bit 6: Reserved?
 Bit 7: Reserved
 Bit 8: F2 packet avilable - Packet is available in F2 TX FIFO
```

### Backplane
TODO:


